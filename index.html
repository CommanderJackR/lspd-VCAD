<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LSPD CAD System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif; background-image: url('https://i.ibb.co/F1f3Dq7/LSPD-2.png');
            background-size: cover; background-position: center; background-attachment: fixed;
            overflow: hidden; user-select: none; background-color: #000; height: 100vh; margin: 0;
        }
        #bootScreenOverlay, #macOSLoginScreen, #shutdownScreenOverlay, #powerButtonScreenEl {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white;
        }
        #bootScreenOverlay { background-color: #000; z-index: 10000; }
        #bootScreenOverlay .apple-logo-boot { font-size: 80px; margin-bottom: 40px; }
        .progress-bar-container { width: 200px; height: 5px; background-color: #333; border-radius: 3px; overflow: hidden; }
        .progress-bar { width: 0%; height: 100%; background-color: #fff; border-radius: 3px; transition: width 0.1s linear; }

        #powerButtonScreenEl { background-color: #000; z-index: 10001; }
        #powerButtonIcon { font-size: 70px; color: #555; cursor: pointer; transition: color 0.3s ease, transform 0.3s ease; }
        #powerButtonIcon:hover { color: #fff; transform: scale(1.1); }

        #macOSLoginScreen { z-index: 9999; backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); background-color: rgba(0,0,0,0.3); }
        .macos-login-box { text-align: center; padding: 40px; }
        .macos-login-box .user-avatar { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 20px auto; object-fit: cover; border: 3px solid rgba(255,255,255,0.5); }
        .macos-login-box .user-name { font-size: 20px; font-weight: 500; color: white; margin-bottom: 20px; }
        .macos-login-box input[type="password"] { padding: 10px 15px; border: 1px solid rgba(255,255,255,0.3); background-color: rgba(255,255,255,0.1); border-radius: 20px; width: 250px; font-size: 14px; color: white; text-align: center; margin-bottom: 15px; outline: none; }
        .macos-login-box input[type="password"]::placeholder { color: rgba(255,255,255,0.6); }
        .macos-login-box button.login-button-macos { padding: 8px 18px; background-color: rgba(255,255,255,0.2); color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 14px; transition: background-color 0.2s; }
        .macos-login-box button.login-button-macos:hover { background-color: rgba(255,255,255,0.4); }
        .macos-login-error { color: #ff8a80; font-size: 13px; margin-top: 10px; height: 20px; }
        #shutdownScreenOverlay { background-color: #000; z-index: 9998; font-size: 20px; }
        #shutdownScreenOverlay .fa-power-off { font-size: 50px; margin-bottom: 20px; animation: spin 2s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .macos-menu-bar { background-color: rgba(255, 255, 255, 0.3); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); color: #333; padding: 0 15px; height: 28px; display: flex; align-items: center; font-size: 13px; position: fixed; top: 0; left: 0; right: 0; z-index: 1000; box-shadow: 0 1px 0 rgba(0,0,0,0.1); }
        .macos-menu-bar .apple-logo-menu { font-size: 16px; margin-right: 15px; cursor: pointer; position: relative; }
        .apple-menu-dropdown { position: absolute; top: 25px; left: 0; background-color: rgba(240, 240, 240, 0.9); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(0,0,0,0.15); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 5px 0; z-index: 1001; min-width: 200px; font-size: 13px; }
        .apple-menu-dropdown-item { padding: 6px 20px; cursor: pointer; color: #333; }
        .apple-menu-dropdown-item:hover { background-color: #007aff; color: white; }
        .apple-menu-separator { height: 1px; background-color: rgba(0,0,0,0.1); margin: 5px 0; }
        .macos-menu-bar .menu-item { padding: 0 8px; cursor: default; }
        .macos-menu-bar .menu-item.font-bold { font-weight: 600; }
        .macos-menu-bar .right-menu { margin-left: auto; display: flex; align-items: center; }
        .macos-menu-bar .right-menu .icon { margin-left: 15px; font-size: 14px; }
        .macos-dock { position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); background-color: rgba(255, 255, 255, 0.4); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-radius: 18px; padding: 8px; display: flex; gap: 10px; z-index: 1000; box-shadow: 0 5px 15px rgba(0,0,0,0.2); transition: all 0.2s ease-in-out; }
        .macos-dock-item { width: 50px; height: 50px; background-color: rgba(240, 240, 240, 0.7); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #333; cursor: pointer; transition: transform 0.1s ease-out, margin-bottom 0.1s ease-out; position: relative; }
        .macos-dock-item:hover { transform: scale(1.3) translateY(-10px); margin-bottom: 5px; background-color: rgba(250, 250, 250, 0.9); }
        .macos-dock-item .tooltip { position: absolute; bottom: 120%; left: 50%; transform: translateX(-50%); background-color: rgba(0,0,0,0.8); color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; white-space: nowrap; opacity: 0; visibility: hidden; transition: opacity 0.2s, visibility 0.2s; }
        .macos-dock-item:hover .tooltip { opacity: 1; visibility: visible; }

        /* General Window Styles */
        .app-window {
            position: absolute;
            background-color: #f0f0f0; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex; flex-direction: column; overflow: hidden; resize: both;
            z-index: 900; visibility: hidden;
            transition: width 0.2s ease-out, height 0.2s ease-out, top 0.2s ease-out, left 0.2s ease-out, border-radius 0.2s ease-out;
        }
        .app-window.visible { visibility: visible; }
        .app-window.maximized { border-radius: 0 !important; resize: none !important; }

        #cadWindowEl { /* Specific initial size for CAD */
            top: 60px; left: 80px; width: 80vw; max-width: 1200px; height: 80vh; max-height: 900px;
            min-width: 700px; min-height: 500px;
        }
        #safariWindowEl { /* Specific initial size for Safari */
            top: 100px; left: 120px; width: 70vw; max-width: 1000px; height: 70vh; max-height: 750px;
            min-width: 500px; min-height: 400px;
        }


        .window-header { background-color: #e0e0e0; padding: 0 12px; height: 32px; display: flex; align-items: center; cursor: grab; border-top-left-radius: inherit; border-top-right-radius: inherit; border-bottom: 1px solid #c5c5c5; }
        .window-header:active { cursor: grabbing; }
        .window-controls { display: flex; gap: 8px; }
        .window-control { width: 12px; height: 12px; border-radius: 50%; cursor: pointer; }
        .control-close { background-color: #ff5f57; border: 1px solid #e0443e;}
        .control-minimize { background-color: #ffbd2e; border: 1px solid #dea123;}
        .control-maximize { background-color: #28c940; border: 1px solid #1DAD2B;}
        .window-title { flex-grow: 1; text-align: center; font-size: 13px; font-weight: 500; color: #555; pointer-events: none; }
        .window-body { flex-grow: 1; overflow: hidden; background-color: #ffffff; display: flex; }
        #safariWindowEl .window-body { padding: 0; }
        #safariFrameEl { width: 100%; height: 100%; border: none; }


        .cad-program { width: 100%; height: 100%; flex-direction: row; display: flex; }
        .cad-sidebar { width: 230px; background-color: #e9ecef; padding: 15px; border-right: 1px solid #ced4da; display: flex; flex-direction: column; gap: 8px; overflow-y: auto; }
        .cad-sidebar-header { text-align: center; margin-bottom: 15px; }
        .cad-sidebar-header .officer-id { font-weight: 600; font-size: 14px; color: #333; }
        .cad-sidebar-item { padding: 10px 12px; border-radius: 6px; cursor: pointer; font-size: 13px; color: #343a40; transition: background-color 0.2s, color 0.2s; display: flex; align-items: center; gap: 10px; }
        .cad-sidebar-item i.fa-fw { width: 1.5em; }
        .cad-sidebar-item:hover, .cad-sidebar-item.active { background-color: #007aff; color: white; }
        .cad-main-content { flex-grow: 1; padding: 20px; overflow-y: auto; }
        .cad-main-content h3 { font-size: 20px; font-weight: 600; color: #333; margin-bottom: 15px; border-bottom: 1px solid #e0e0e0; padding-bottom: 10px; }
        .copnet-section .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;}
        .copnet-section .search-bar { display: flex; gap: 10px; margin-bottom: 20px; align-items: center; }
        .copnet-section input[type="text"], .copnet-section input[type="date"], .copnet-section input[type="time"], .copnet-section select, .copnet-section textarea { padding: 8px 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px; flex-grow: 1; }
        .copnet-section textarea { min-height: 80px; }
        .copnet-section button { padding: 8px 15px; background-color: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; transition: background-color 0.2s; }
        .copnet-section button:hover { background-color: #0056b3; }
        .copnet-section button.secondary { background-color: #6c757d; }
        .copnet-section button.secondary:hover { background-color: #545b62; }
        .copnet-section button.danger { background-color: #dc3545; }
        .copnet-section button.danger:hover { background-color: #bd2130; }
        .results-area { margin-top: 20px; }
        .results-area table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .results-area th, .results-area td { border: 1px solid #dee2e6; padding: 8px 10px; text-align: left; vertical-align: middle;}
        .results-area th { background-color: #f8f9fa; }
        .results-area .action-buttons button { margin-right: 5px; padding: 4px 8px; font-size: 12px; }
        .detail-view { margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;}
        .detail-view h4 { font-size: 16px; margin-bottom: 10px; color: #007bff; border-bottom: 1px solid #e0e0e0; padding-bottom: 5px; display: flex; justify-content: space-between; align-items: center;}
        .detail-view p { margin-bottom: 8px; font-size: 14px; line-height: 1.6; }
        .detail-view strong { color: #495057; min-width: 120px; display: inline-block;}
        .detail-view .flag { padding: 3px 8px; border-radius: 4px; font-size: 12px; color: white; margin-left: 5px;}
        .flag.wanted { background-color: #dc3545; }
        .flag.caution { background-color: #ffc107; color: #333; }
        .detail-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
        .detail-view img.profile-pic, .detail-view img.vehicle-pic { max-width: 150px; height: auto; border-radius: 6px; margin-bottom: 10px; border: 1px solid #ddd; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .dashboard-card { background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; }
        .dashboard-card h4 { font-size: 16px; font-weight: 500; margin-bottom: 10px; color: #007aff; }
        .dashboard-card ul { list-style: disc; padding-left: 20px; font-size: 14px; color: #555;}
        .dashboard-card li { margin-bottom: 5px; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); display: flex; align-items: center; justify-content: center; z-index: 2000; }
        .modal-box { background-color: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); width: 90%; max-width: 700px; max-height: 85vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-header h4 { font-size: 18px; font-weight: 600; color: #333; }
        .modal-close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #777; }
        .modal-body form label { display: block; margin-bottom: 5px; font-size: 14px; color: #555; font-weight: 500;}
        .modal-body form input, .modal-body form textarea, .modal-body form select { width: 100%; margin-bottom: 15px; }
        .modal-footer { margin-top: 20px; text-align: right; }
        .status-dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .status-available { background-color: #28a745; }
        .status-busy { background-color: #ffc107; }
        .status-unavailable { background-color: #dc3545; }
        .status-offduty { background-color: #6c757d; }
        .resizer { width: 10px; height: 10px; background: transparent; position:absolute; right:0; bottom:0; cursor:nwse-resize; }
        .hidden { display: none !important; }
        .flex-display { display: flex !important; }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="powerButtonScreenEl" class="flex-display"> <i id="powerButtonIcon" class="fas fa-power-off"></i></div>
    <div id="bootScreenOverlay" class="hidden"><i class="fab fa-apple apple-logo-boot"></i><div class="progress-bar-container"><div id="bootProgressBar" class="progress-bar"></div></div></div>
    <div id="macOSLoginScreen" class="hidden"><div class="macos-login-box"><img src="https://i.ibb.co/5gR8SmSv/lspd-logo.png" alt="LSPD Officer" class="user-avatar" onerror="this.src='https://placehold.co/100x100/cccccc/ffffff?text=PD';"><div id="macOSLoginUserName" class="user-name">PD-61</div><input type="password" id="macOSPasswordInput" placeholder="Passwort eingeben"><button id="macOSLoginButton" class="login-button-macos"><i class="fas fa-arrow-right"></i></button><p id="macOSLoginError" class="macos-login-error"></p></div></div>
    <div id="shutdownScreenOverlay" class="hidden"><i class="fas fa-power-off"></i><span>Herunterfahren...</span></div>

    <div id="desktopEnvironment" class="hidden">
        <div class="macos-menu-bar">
            <div id="appleLogoMenuContainer" class="apple-logo-menu"><i class="fab fa-apple"></i><div id="appleMenuDropdownEl" class="apple-menu-dropdown hidden"><div class="apple-menu-dropdown-item">Über diesen Mac (simuliert)</div><div class="apple-menu-separator"></div><div id="logoutMacOSMenuItem" class="apple-menu-dropdown-item">Abmelden (PD-61)...</div><div class="apple-menu-separator"></div><div id="shutdownMenuItem" class="apple-menu-dropdown-item">Herunterfahren...</div></div></div>
            <span class="menu-item font-bold">LSPD CAD</span><span class="menu-item">Ablage</span><span class="menu-item">Bearbeiten</span><span class="menu-item">Darstellung</span><span class="menu-item">Fenster</span><span class="menu-item">Hilfe</span>
            <div class="right-menu"><span id="currentTimeEl" class="menu-item text-xs"></span><i class="fas fa-wifi icon"></i><i class="fas fa-battery-full icon"></i><i class="fas fa-search icon"></i></div>
        </div>

        <div id="cadWindowEl" class="app-window">
            <div class="window-header" id="cadHeaderEl">
                <div class="window-controls"><div class="window-control control-close" id="cadCloseBtnEl"></div><div class="window-control control-minimize" id="cadMinimizeBtnEl"></div><div class="window-control control-maximize" id="cadMaximizeBtnEl"></div></div>
                <div class="window-title">LSPD CAD System</div>
            </div>
            <div class="window-body">
                <div id="cadProgramEl" class="cad-program">
                    <div class="cad-sidebar">
                        <div class="cad-sidebar-header"><img src="https://i.ibb.co/5gR8SmSv/lspd-logo.png" alt="LSPD Logo" class="h-12 mx-auto mb-2" onerror="this.src='https://placehold.co/48x48/cccccc/333333?text=LSPD';"><div id="officerIdDisplayInCADEl" class="officer-id">PD-XXXX</div></div>
                        <div class="cad-sidebar-item active" data-target="dashboardContent"><i class="fas fa-tachometer-alt fa-fw"></i> Dashboard</div>
                        <div class="cad-sidebar-item" data-target="personSearchContent"><i class="fas fa-user-friends fa-fw"></i> Personensuche</div>
                        <div class="cad-sidebar-item" data-target="vehicleSearchContent"><i class="fas fa-car fa-fw"></i> Fahrzeugsuche</div>
                        <div class="cad-sidebar-item" data-target="dispatchContent"><i class="fas fa-headset fa-fw"></i> Leitstelle</div>
                        <div class="cad-sidebar-item" data-target="boloContent"><i class="fas fa-bullseye fa-fw"></i> Fahndungen</div>
                        <div class="cad-sidebar-item" data-target="reportsContent"><i class="fas fa-file-alt fa-fw"></i> Berichte</div>
                        <div class="cad-sidebar-item" data-target="knowledgeBaseContent"><i class="fas fa-book fa-fw"></i> Gesetze & DB</div>
                    </div>
                    <div class="cad-main-content">
                        <div id="dashboardContent" class="active-content copnet-section"><h3>Willkommen im LSPD CAD, Officer <span id="loggedInOfficerNameEl"></span></h3><div class="dashboard-grid"><div class="dashboard-card"><h4><i class="fas fa-bell"></i> Aktive Einsätze</h4><ul id="dashboardActiveIncidentsList"><li>Keine aktiven Einsätze</li></ul></div><div class="dashboard-card"><h4><i class="fas fa-clipboard-list"></i> Meine letzten Berichte</h4><ul id="dashboardMyReportsList"><li>Keine Berichte</li></ul></div><div class="dashboard-card"><h4><i class="fas fa-users"></i> Team Status</h4><ul id="unitStatusListDashboardEl"><li>Keine Einheiten im Dienst</li></ul></div><div class="dashboard-card"><h4><i class="fas fa-exclamation-triangle"></i> Wichtige Fahndungen</h4><ul><li>John Doe (Bankraub)</li></ul></div></div></div>
                        <div id="personSearchContent" class="hidden copnet-section">
                            <div class="section-header"><h3>Personensuche</h3><button id="createNewPersonBtnEl"><i class="fas fa-user-plus"></i> Neue Akte erstellen</button></div>
                            <div class="search-bar"><input type="text" id="personSearchNameInputEl" placeholder="Name, Vorname..."><input type="text" id="personSearchIdInputEl" placeholder="Bürger-ID..."><button id="personSearchBtnEl"><i class="fas fa-search"></i> Suchen</button></div>
                            <div id="personResultsAreaEl" class="results-area"><p class="text-gray-500">Bitte Suchkriterien eingeben.</p></div>
                            <div id="personDetailViewEl" class="detail-view hidden">
                                <div class="flex items-start gap-4"><img id="detailPersonProfilePicEl" src="https://placehold.co/100x100/cccccc/ffffff?text=Bild" alt="Profilbild" class="profile-pic" onerror="this.src='https://placehold.co/100x100/cccccc/ffffff?text=Bild';"><div><h4><span id="detailViewPersonNameEl"></span> <span id="detailViewPersonWantedFlagEl" class="flag hidden"></span></h4><p><strong>Bürger-ID:</strong> <span id="detailPersonIdEl"></span></p><p><strong>Geburtsdatum:</strong> <span id="detailPersonDobEl"></span></p></div><button id="editPersonBtnEl" class="ml-auto secondary"><i class="fas fa-edit"></i> Bearbeiten</button></div>
                                <div class="detail-grid mt-4"><div><p><strong>Adresse:</strong> <span id="detailPersonAddressEl"></span></p></div><div><p><strong>Telefon:</strong> <span id="detailPersonPhoneEl"></span></p></div><div><p><strong>Beruf:</strong> <span id="detailPersonOccupationEl"></span></p></div><div><p><strong>Fahndungsstatus:</strong> <span id="detailPersonWantedStatusOutputEl"></span></p></div></div>
                                <p><strong>Merkmale:</strong> <span id="detailPersonFeaturesEl"></span></p><p><strong>Bekannte Fahrzeuge:</strong> <span id="detailPersonVehiclesListEl"></span></p><p><strong>Lizenzen:</strong> <span id="detailPersonLicensesEl"></span></p>
                                <h5 class="mt-3 font-semibold text-sm">Vorstrafen:</h5><ul id="detailPersonPriorsEl" class="list-disc pl-5 text-sm"><li>Keine Einträge</li></ul>
                                <h5 class="mt-3 font-semibold text-sm">Notizen:</h5><p id="detailPersonNotesEl" class="text-sm bg-white p-2 border rounded">Keine Notizen vorhanden.</p>
                            </div>
                        </div>
                        <div id="vehicleSearchContent" class="hidden copnet-section">
                            <div class="section-header"><h3>Fahrzeugsuche</h3><button id="createNewVehicleBtnEl"><i class="fas fa-car-plus"></i> Neues Fahrzeug erfassen</button></div>
                            <div class="search-bar"><input type="text" id="vehicleSearchPlateInputEl" placeholder="Kennzeichen..."><input type="text" id="vehicleSearchOwnerIdInputEl" placeholder="Halter Bürger-ID..."><button id="vehicleSearchBtnEl"><i class="fas fa-search"></i> Suchen</button></div>
                            <div id="vehicleResultsAreaEl" class="results-area"><p class="text-gray-500">Bitte Suchkriterien eingeben.</p></div>
                            <div id="vehicleDetailViewEl" class="detail-view hidden">
                                <div class="flex items-start gap-4"><img id="detailVehicleImageEl" src="https://placehold.co/150x100/cccccc/ffffff?text=Fahrzeug" alt="Fahrzeugbild" class="vehicle-pic" onerror="this.src='https://placehold.co/150x100/cccccc/ffffff?text=Fahrzeug';"><div><h4>Kennzeichen: <span id="detailVehiclePlateEl"></span> <span id="detailVehicleWantedFlagEl" class="flag hidden"></span></h4><p><strong>Marke:</strong> <span id="detailVehicleMakeEl"></span></p><p><strong>Modell:</strong> <span id="detailVehicleModelEl"></span></p></div><button id="editVehicleBtnEl" class="ml-auto secondary"><i class="fas fa-edit"></i> Bearbeiten</button></div>
                                <div class="detail-grid mt-4"><div><p><strong>Farbe:</strong> <span id="detailVehicleColorEl"></span></p></div><div><p><strong>Halter:</strong> <span id="detailVehicleOwnerNameEl"></span> (ID: <span id="detailVehicleOwnerIdEl"></span>)</p></div><div><p><strong>Fahndungsstatus:</strong> <span id="detailVehicleWantedStatusOutputEl"></span></p></div></div>
                                <h5 class="mt-3 font-semibold text-sm">Notizen zum Fahrzeug:</h5><p id="detailVehicleNotesEl" class="text-sm bg-white p-2 border rounded">Keine Notizen vorhanden.</p>
                            </div>
                        </div>
                        <div id="dispatchContent" class="hidden copnet-section">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="md:col-span-1"><h3>Einheiten im Dienst</h3><div id="unitManagementSectionEl" class="mb-4 p-3 border rounded-md bg-gray-50"><label for="unitIdInputEl" class="block text-sm font-medium">Meine Einheit-ID:</label><input type="text" id="unitIdInputEl" placeholder="z.B. 1-ADAM-12" class="mb-2"><label for="unitStatusSelectEl" class="block text-sm font-medium">Status:</label><select id="unitStatusSelectEl" class="mb-2"><option value="Verfügbar">Verfügbar</option><option value="Im Einsatz">Im Einsatz</option><option value="Pause">Pause</option><option value="Nicht im Dienst">Nicht im Dienst</option></select><button id="updateUnitStatusBtnEl" class="w-full">Status aktualisieren / Anmelden</button></div><div id="activeUnitsListEl" class="results-area"></div></div>
                                <div class="md:col-span-2"><div class="section-header"><h3>Aktive Einsätze</h3><button id="createNewIncidentBtnEl"><i class="fas fa-plus-circle"></i> Neuen Einsatz erstellen</button></div><div id="activeIncidentsListEl" class="results-area"><table><thead><tr><th>ID</th><th>Typ</th><th>Priorität</th><th>Ort</th><th>Status</th><th>Einheiten</th><th>Aktionen</th></tr></thead><tbody id="activeIncidentsTableBodyEl"><tr><td colspan="7" class="text-center text-gray-500">Keine aktiven Einsätze.</td></tr></tbody></table></div></div>
                            </div>
                            <div id="incidentDetailViewEl" class="detail-view hidden mt-6"><h4>Einsatzdetails: #<span id="detailIncidentIdEl"></span></h4><p><strong>Typ:</strong> <span id="detailIncidentTypeEl"></span></p><p><strong>Ort:</strong> <span id="detailIncidentLocationEl"></span></p><p><strong>Priorität:</strong> <span id="detailIncidentPriorityEl"></span></p><p><strong>Status:</strong> <span id="detailIncidentStatusEl"></span></p><p><strong>Beschreibung:</strong> <span id="detailIncidentDescriptionEl"></span></p><p><strong>Zugewiesene Einheiten:</strong> <span id="detailIncidentUnitsEl"></span></p><div class="mt-4"><label for="assignUnitToIncidentSelectEl" class="block text-sm font-medium">Einheit zuweisen:</label><select id="assignUnitToIncidentSelectEl" class="mb-2"></select><button id="assignUnitBtnEl" class="mr-2">Zuweisen</button><button id="createReportFromIncidentBtnEl" class="secondary">Bericht erstellen</button></div></div>
                        </div>
                        <div id="boloContent" class="hidden copnet-section"><h3>Fahndungsliste (BOLO)</h3><div class="results-area"><table><thead><tr><th>Priorität</th><th>Typ</th><th>Beschreibung</th><th>Letzte Sichtung</th><th>Aktionen</th></tr></thead><tbody><tr><td>Hoch</td><td>Person</td><td>John Doe, bewaffneter Raubüberfall</td><td>Davis, Gestern</td><td><button class="text-xs p-1">Details</button></td></tr></tbody></table></div></div>
                        <div id="reportsContent" class="hidden copnet-section">
                            <div class="section-header"><h3>Berichtswesen</h3></div>
                            <div id="reportsListAreaEl" class="results-area"><table><thead><tr><th>Bericht-ID</th><th>Einsatz-ID</th><th>Titel</th><th>Datum</th><th>Beamter</th><th>Aktionen</th></tr></thead><tbody id="reportsTableBodyEl"><tr><td colspan="6" class="text-center text-gray-500">Keine Berichte vorhanden.</td></tr></tbody></table></div>
                            <div id="reportDetailViewEl" class="detail-view hidden"><h4>Bericht: #<span id="detailReportIdEl"></span> (Einsatz: #<span id="detailReportIncidentIdEl"></span>)</h4><p><strong>Datum/Zeit:</strong> <span id="detailReportTimestampEl"></span></p><p><strong>Verfasser:</strong> <span id="detailReportOfficerEl"></span></p><p><strong>Ort:</strong> <span id="detailReportLocationEl"></span></p><p><strong>Titel/Art:</strong> <span id="detailReportTitleEl"></span></p><h5 class="mt-3 font-semibold text-sm">Sachverhalt:</h5><p id="detailReportNarrativeEl" class="text-sm bg-white p-2 border rounded"></p><h5 class="mt-3 font-semibold text-sm">Beteiligte Personen:</h5><ul id="detailReportPersonsEl" class="list-disc pl-5 text-sm"></ul><h5 class="mt-3 font-semibold text-sm">Beteiligte Fahrzeuge:</h5><ul id="detailReportVehiclesEl" class="list-disc pl-5 text-sm"></ul><h5 class="mt-3 font-semibold text-sm">Maßnahmen:</h5><p id="detailReportActionsEl" class="text-sm"></p></div>
                        </div>
                        <div id="knowledgeBaseContent" class="hidden copnet-section"><h3>Gesetze & Wissensdatenbank</h3><div class="search-bar"><input type="text" placeholder="Suche nach Paragraph, Stichwort..."><button><i class="fas fa-search"></i> Suchen</button></div><div class="results-area"><p>Platzhalter.</p></div></div>
                    </div>
                </div>
            </div>
            <div class="resizer" id="resizerEl"></div>
        </div>

        <div id="safariWindowEl" class="app-window">
            <div class="window-header" id="safariHeaderEl">
                <div class="window-controls">
                    <div class="window-control control-close" id="safariCloseBtnEl"></div>
                    <div class="window-control control-minimize" id="safariMinimizeBtnEl"></div>
                    <div class="window-control control-maximize" id="safariMaximizeBtnEl"></div>
                </div>
                <div class="window-title">Safari</div>
            </div>
            <div class="window-body">
                <iframe id="safariFrameEl" src="about:blank"></iframe>
            </div>
             <div class="resizer" id="safariResizerEl"></div>
        </div>


        <div id="createPersonModalEl" class="modal-overlay hidden"><div class="modal-box"><div class="modal-header"><h4>Personenakte</h4><button id="closeCreatePersonModalBtnEl" class="modal-close-btn">&times;</button></div><div class="modal-body"><form id="createPersonFormEl"><input type="hidden" id="editingPersonCitizenIdEl"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="personFirstNameEl">Vorname:</label><input type="text" id="personFirstNameEl" required></div><div><label for="personLastNameEl">Nachname:</label><input type="text" id="personLastNameEl" required></div><div><label for="personDobEl">Geburtsdatum:</label><input type="date" id="personDobEl"></div><div><label for="personCitizenIdEl">Bürger-ID:</label><input type="text" id="personCitizenIdEl"></div></div><label for="personAddressEl">Adresse:</label><input type="text" id="personAddressEl"><label for="personPhoneEl">Telefon:</label><input type="text" id="personPhoneEl"><label for="personOccupationEl">Beruf:</label><input type="text" id="personOccupationEl"><label for="personProfilePicUrlEl">Profilbild URL:</label><input type="text" id="personProfilePicUrlEl" placeholder="https://beispiel.de/bild.png"><label for="personFeaturesEl">Besondere Merkmale:</label><textarea id="personFeaturesEl"></textarea><label for="personLicensesEl">Lizenzen (kommagetrennt):</label><input type="text" id="personLicensesEl"><label for="personWantedStatusModalEl">Fahndungsstatus:</label><select id="personWantedStatusModalEl"><option value="Kein Eintrag">Kein Eintrag</option><option value="Gesucht">Gesucht</option><option value="Vorsicht">Vorsicht Geboten</option></select><label for="personNotesEl">Notizen:</label><textarea id="personNotesEl"></textarea></form></div><div class="modal-footer"><button type="button" id="savePersonBtnEl" class="mr-2">Speichern</button><button type="button" id="cancelPersonBtnEl" class="secondary">Abbrechen</button></div></div></div>
        <div id="createVehicleModalEl" class="modal-overlay hidden"><div class="modal-box"><div class="modal-header"><h4>Fahrzeugakte</h4><button id="closeCreateVehicleModalBtnEl" class="modal-close-btn">&times;</button></div><div class="modal-body"><form id="createVehicleFormEl"><input type="hidden" id="editingVehiclePlateEl"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="vehiclePlateEl">Kennzeichen:</label><input type="text" id="vehiclePlateEl" required></div><div><label for="vehicleMakeEl">Marke:</label><input type="text" id="vehicleMakeEl"></div><div><label for="vehicleModelEl">Modell:</label><input type="text" id="vehicleModelEl"></div><div><label for="vehicleColorEl">Farbe:</label><input type="text" id="vehicleColorEl"></div></div><label for="vehicleOwnerCitizenIdEl">Halter Bürger-ID (optional):</label><input type="text" id="vehicleOwnerCitizenIdEl"><label for="vehicleImageUrlEl">Fahrzeugbild URL:</label><input type="text" id="vehicleImageUrlEl" placeholder="https://beispiel.de/fahrzeug.png"><label for="vehicleWantedStatusModalEl">Fahndungsstatus:</label><select id="vehicleWantedStatusModalEl"><option value="Kein Eintrag">Kein Eintrag</option><option value="Gestohlen">Gestohlen</option><option value="Zur Fahndung (Verbrechen)">Zur Fahndung (Verbrechen)</option></select><label for="vehicleNotesEl">Notizen zum Fahrzeug:</label><textarea id="vehicleNotesEl"></textarea></form></div><div class="modal-footer"><button type="button" id="saveVehicleBtnEl" class="mr-2">Speichern</button><button type="button" id="cancelVehicleBtnEl" class="secondary">Abbrechen</button></div></div></div>
        <div id="createIncidentModalEl" class="modal-overlay hidden"><div class="modal-box"><div class="modal-header"><h4>Neuen Einsatz erstellen</h4><button id="closeCreateIncidentModalBtnEl" class="modal-close-btn">&times;</button></div><div class="modal-body"><form id="createIncidentFormEl"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="incidentTypeEl">Einsatztyp:</label><select id="incidentTypeEl"><option>Verkehrskontrolle</option><option>Einbruch</option><option>Raubüberfall</option><option>Schlägerei</option><option>Verdächtige Person</option><option>Sonstiges</option></select></div><div><label for="incidentPriorityEl">Priorität:</label><select id="incidentPriorityEl"><option value="Niedrig">Niedrig</option><option value="Mittel">Mittel</option><option value="Hoch">Hoch</option></select></div></div><label for="incidentLocationEl">Ort:</label><input type="text" id="incidentLocationEl" required><label for="incidentCallerNameEl">Anrufer Name (optional):</label><input type="text" id="incidentCallerNameEl"><label for="incidentCallerPhoneEl">Anrufer Telefon (optional):</label><input type="text" id="incidentCallerPhoneEl"><label for="incidentDescriptionEl">Kurzbeschreibung:</label><textarea id="incidentDescriptionEl" required></textarea></form></div><div class="modal-footer"><button type="button" id="saveIncidentBtnEl" class="mr-2">Einsatz erstellen</button><button type="button" id="cancelIncidentBtnEl" class="secondary">Abbrechen</button></div></div></div>
        <div id="createReportModalEl" class="modal-overlay hidden"><div class="modal-box" style="max-width: 800px;"><div class="modal-header"><h4>Bericht erstellen</h4><button id="closeCreateReportModalBtnEl" class="modal-close-btn">&times;</button></div><div class="modal-body"><form id="createReportFormEl"><input type="hidden" id="reportIncidentIdInputEl"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="reportTitleEl">Titel/Art des Vorfalls:</label><input type="text" id="reportTitleEl" required></div><div><label for="reportLocationEl">Ort des Vorfalls:</label><input type="text" id="reportLocationEl" required></div></div><label for="reportNarrativeEl">Sachverhalt:</label><textarea id="reportNarrativeEl" rows="5" required></textarea><label for="reportPersonsInvolvedEl">Beteiligte Personen (Namen, Rollen - pro Zeile):</label><textarea id="reportPersonsInvolvedEl" rows="3"></textarea><label for="reportVehiclesInvolvedEl">Beteiligte Fahrzeuge (Kennzeichen - pro Zeile):</label><textarea id="reportVehiclesInvolvedEl" rows="2"></textarea><label for="reportActionsTakenEl">Getroffene Maßnahmen:</label><textarea id="reportActionsTakenEl" rows="3"></textarea></form></div><div class="modal-footer"><button type="button" id="saveReportBtnEl" class="mr-2">Bericht speichern</button><button type="button" id="cancelReportBtnEl" class="secondary">Abbrechen</button></div></div></div>

        <div class="macos-dock"><div class="macos-dock-item" id="finderIconEl"><i class="fas fa-folder-open"></i><span class="tooltip">Finder</span></div><div class="macos-dock-item" id="launchpadIconEl"><i class="fas fa-th-large"></i><span class="tooltip">Launchpad</span></div><div class="macos-dock-item" id="cadAppIconEl"><i class="fas fa-shield-alt"></i><span class="tooltip">LSPD CAD</span></div><div class="macos-dock-item" id="safariAppIconEl"><i class="fab fa-safari"></i><span class="tooltip">Safari</span></div> <div class="macos-dock-item"><i class="fas fa-envelope"></i><span class="tooltip">Mail</span></div>
            <div class="macos-dock-item"><i class="fas fa-trash"></i><span class="tooltip">Papierkorb</span></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const jsPowerButtonScreenEl = document.getElementById('powerButtonScreenEl');
            const jsPowerButtonIconEl = document.getElementById('powerButtonIcon');
            const jsBootScreenOverlayEl = document.getElementById('bootScreenOverlay');
            const jsBootProgressBarEl = document.getElementById('bootProgressBar');
            const jsMacOSLoginScreenEl = document.getElementById('macOSLoginScreen');
            const jsMacOSPasswordInputEl = document.getElementById('macOSPasswordInput');
            const jsMacOSLoginButtonEl = document.getElementById('macOSLoginButton');
            const jsMacOSLoginErrorEl = document.getElementById('macOSLoginError');
            const jsMacOSLoginUserNameEl = document.getElementById('macOSLoginUserName');
            const jsShutdownScreenOverlayEl = document.getElementById('shutdownScreenOverlay');
            const jsDesktopEnvironmentEl = document.getElementById('desktopEnvironment');
            const jsAppleLogoMenuContainerEl = document.getElementById('appleLogoMenuContainer');
            const jsAppleMenuDropdownEl = document.getElementById('appleMenuDropdownEl');
            const jsLogoutMacOSMenuItemEl = document.getElementById('logoutMacOSMenuItem');
            const jsShutdownMenuItemEl = document.getElementById('shutdownMenuItem');
            const jsCurrentTimeEl = document.getElementById('currentTimeEl');

            const jsCadWindowEl = document.getElementById('cadWindowEl');
            const jsCadHeaderEl = document.getElementById('cadHeaderEl');
            const jsCadCloseBtnEl = document.getElementById('cadCloseBtnEl');
            const jsCadMinimizeBtnEl = document.getElementById('cadMinimizeBtnEl');
            const jsCadMaximizeBtnEl = document.getElementById('cadMaximizeBtnEl');
            const jsCadResizerEl = document.getElementById('resizerEl');
            const jsCadAppIconEl = document.getElementById('cadAppIconEl');
            const jsOfficerIdDisplayInCADEl = document.getElementById('officerIdDisplayInCADEl');
            const jsLoggedInOfficerNameEl = document.getElementById('loggedInOfficerNameEl');

            const jsSafariWindowEl = document.getElementById('safariWindowEl');
            const jsSafariHeaderEl = document.getElementById('safariHeaderEl');
            const jsSafariCloseBtnEl = document.getElementById('safariCloseBtnEl');
            const jsSafariMinimizeBtnEl = document.getElementById('safariMinimizeBtnEl');
            const jsSafariMaximizeBtnEl = document.getElementById('safariMaximizeBtnEl');
            const jsSafariFrameEl = document.getElementById('safariFrameEl');
            const jsSafariResizerEl = document.getElementById('safariResizerEl');
            const jsSafariAppIconEl = document.getElementById('safariAppIconEl');

            const jsPersonSearchNameInputEl = document.getElementById('personSearchNameInputEl');
            const jsPersonSearchIdInputEl = document.getElementById('personSearchIdInputEl');
            const jsPersonSearchBtnEl = document.getElementById('personSearchBtnEl');
            const jsPersonResultsAreaEl = document.getElementById('personResultsAreaEl');
            const jsPersonDetailViewEl = document.getElementById('personDetailViewEl');
            const jsDetailPersonProfilePicEl = document.getElementById('detailPersonProfilePicEl');
            const jsDetailViewPersonNameEl = document.getElementById('detailViewPersonNameEl');
            const jsDetailViewPersonWantedFlagEl = document.getElementById('detailViewPersonWantedFlagEl');
            const jsDetailPersonIdEl = document.getElementById('detailPersonIdEl');
            const jsDetailPersonDobEl = document.getElementById('detailPersonDobEl');
            const jsDetailPersonAddressEl = document.getElementById('detailPersonAddressEl');
            const jsDetailPersonPhoneEl = document.getElementById('detailPersonPhoneEl');
            const jsDetailPersonOccupationEl = document.getElementById('detailPersonOccupationEl');
            const jsDetailPersonWantedStatusOutputEl = document.getElementById('detailPersonWantedStatusOutputEl');
            const jsDetailPersonFeaturesEl = document.getElementById('detailPersonFeaturesEl');
            const jsDetailPersonVehiclesListEl = document.getElementById('detailPersonVehiclesListEl');
            const jsDetailPersonLicensesEl = document.getElementById('detailPersonLicensesEl');
            const jsDetailPersonPriorsEl = document.getElementById('detailPersonPriorsEl');
            const jsDetailPersonNotesEl = document.getElementById('detailPersonNotesEl');
            const jsEditPersonBtnEl = document.getElementById('editPersonBtnEl');

            const jsCreateNewPersonBtnEl = document.getElementById('createNewPersonBtnEl');
            const jsCreatePersonModalEl = document.getElementById('createPersonModalEl');
            const jsCloseCreatePersonModalBtnEl = document.getElementById('closeCreatePersonModalBtnEl');
            const jsSavePersonBtnEl = document.getElementById('savePersonBtnEl');
            const jsCancelPersonBtnEl = document.getElementById('cancelPersonBtnEl');
            const jsCreatePersonFormEl = document.getElementById('createPersonFormEl');
            const jsPersonModalFirstNameEl = document.getElementById('personFirstNameEl');
            const jsPersonModalLastNameEl = document.getElementById('personLastNameEl');
            const jsPersonModalDobEl = document.getElementById('personDobEl');
            const jsPersonModalCitizenIdEl = document.getElementById('personCitizenIdEl');
            const jsPersonModalAddressEl = document.getElementById('personAddressEl');
            const jsPersonModalPhoneEl = document.getElementById('personPhoneEl');
            const jsPersonModalOccupationEl = document.getElementById('personOccupationEl');
            const jsPersonModalProfilePicUrlEl = document.getElementById('personProfilePicUrlEl');
            const jsPersonModalFeaturesEl = document.getElementById('personFeaturesEl');
            const jsPersonModalLicensesEl = document.getElementById('personLicensesEl');
            const jsPersonModalWantedStatusEl = document.getElementById('personWantedStatusModalEl');
            const jsPersonModalNotesEl = document.getElementById('personNotesEl');
            const jsEditingPersonCitizenIdFieldEl = document.getElementById('editingPersonCitizenIdEl');

            const jsCreateNewVehicleBtnEl = document.getElementById('createNewVehicleBtnEl');
            const jsCreateVehicleModalEl = document.getElementById('createVehicleModalEl');
            const jsCloseCreateVehicleModalBtnEl = document.getElementById('closeCreateVehicleModalBtnEl');
            const jsSaveVehicleBtnEl = document.getElementById('saveVehicleBtnEl');
            const jsCancelVehicleBtnEl = document.getElementById('cancelVehicleBtnEl');
            const jsCreateVehicleFormEl = document.getElementById('createVehicleFormEl');
            const jsVehicleSearchPlateInputEl = document.getElementById('vehicleSearchPlateInputEl');
            const jsVehicleSearchOwnerIdInputEl = document.getElementById('vehicleSearchOwnerIdInputEl');
            const jsVehicleSearchBtnEl = document.getElementById('vehicleSearchBtnEl');
            const jsVehicleResultsAreaEl = document.getElementById('vehicleResultsAreaEl');
            const jsVehicleDetailViewEl = document.getElementById('vehicleDetailViewEl');
            const jsDetailVehicleImageEl = document.getElementById('detailVehicleImageEl');
            const jsDetailVehiclePlateEl = document.getElementById('detailVehiclePlateEl');
            const jsDetailVehicleWantedFlagEl = document.getElementById('detailVehicleWantedFlagEl');
            const jsDetailVehicleMakeEl = document.getElementById('detailVehicleMakeEl');
            const jsDetailVehicleModelEl = document.getElementById('detailVehicleModelEl');
            const jsDetailVehicleColorEl = document.getElementById('detailVehicleColorEl');
            const jsDetailVehicleOwnerNameEl = document.getElementById('detailVehicleOwnerNameEl');
            const jsDetailVehicleOwnerIdEl = document.getElementById('detailVehicleOwnerIdEl');
            const jsDetailVehicleWantedStatusOutputEl = document.getElementById('detailVehicleWantedStatusOutputEl');
            const jsDetailVehicleNotesEl = document.getElementById('detailVehicleNotesEl');
            const jsEditVehicleBtnEl = document.getElementById('editVehicleBtnEl');
            const jsVehicleModalPlateEl = document.getElementById('vehiclePlateEl');
            const jsVehicleModalMakeEl = document.getElementById('vehicleMakeEl');
            const jsVehicleModalModelEl = document.getElementById('vehicleModelEl');
            const jsVehicleModalColorEl = document.getElementById('vehicleColorEl');
            const jsVehicleModalOwnerCitizenIdEl = document.getElementById('vehicleOwnerCitizenIdEl');
            const jsVehicleModalImageUrlEl = document.getElementById('vehicleImageUrlEl');
            const jsVehicleModalWantedStatusEl = document.getElementById('vehicleWantedStatusModalEl');
            const jsVehicleModalNotesEl = document.getElementById('vehicleNotesEl');
            const jsEditingVehiclePlateFieldEl = document.getElementById('editingVehiclePlateEl');

            const jsUnitIdInputEl = document.getElementById('unitIdInputEl');
            const jsUnitStatusSelectEl = document.getElementById('unitStatusSelectEl');
            const jsUpdateUnitStatusBtnEl = document.getElementById('updateUnitStatusBtnEl');
            const jsActiveUnitsListEl = document.getElementById('activeUnitsListEl');
            const jsCreateNewIncidentBtnEl = document.getElementById('createNewIncidentBtnEl');
            const jsActiveIncidentsTableBodyEl = document.getElementById('activeIncidentsTableBodyEl');
            const jsIncidentDetailViewEl = document.getElementById('incidentDetailViewEl');
            const jsDetailIncidentIdEl = document.getElementById('detailIncidentIdEl');
            const jsDetailIncidentTypeEl = document.getElementById('detailIncidentTypeEl');
            const jsDetailIncidentLocationEl = document.getElementById('detailIncidentLocationEl');
            const jsDetailIncidentPriorityEl = document.getElementById('detailIncidentPriorityEl');
            const jsDetailIncidentStatusEl = document.getElementById('detailIncidentStatusEl');
            const jsDetailIncidentDescriptionEl = document.getElementById('detailIncidentDescriptionEl');
            const jsDetailIncidentUnitsEl = document.getElementById('detailIncidentUnitsEl');
            const jsAssignUnitToIncidentSelectEl = document.getElementById('assignUnitToIncidentSelectEl');
            const jsAssignUnitBtnEl = document.getElementById('assignUnitBtnEl');
            const jsCreateReportFromIncidentBtnEl = document.getElementById('createReportFromIncidentBtnEl');

            const jsCreateIncidentModalEl = document.getElementById('createIncidentModalEl');
            const jsCloseCreateIncidentModalBtnEl = document.getElementById('closeCreateIncidentModalBtnEl');
            const jsSaveIncidentBtnEl = document.getElementById('saveIncidentBtnEl');
            const jsCancelIncidentBtnEl = document.getElementById('cancelIncidentBtnEl');
            const jsCreateIncidentFormEl = document.getElementById('createIncidentFormEl');
            const jsIncidentModalTypeEl = document.getElementById('incidentTypeEl');
            const jsIncidentModalPriorityEl = document.getElementById('incidentPriorityEl');
            const jsIncidentModalLocationEl = document.getElementById('incidentLocationEl');
            const jsIncidentModalCallerNameEl = document.getElementById('incidentCallerNameEl');
            const jsIncidentModalCallerPhoneEl = document.getElementById('incidentCallerPhoneEl');
            const jsIncidentModalDescriptionEl = document.getElementById('incidentDescriptionEl');

            const jsReportsListAreaTableBodyEl = document.getElementById('reportsTableBodyEl');
            const jsReportDetailViewEl = document.getElementById('reportDetailViewEl');
            const jsDetailReportIdEl = document.getElementById('detailReportIdEl');
            const jsDetailReportIncidentIdEl = document.getElementById('detailReportIncidentIdEl');
            const jsDetailReportTimestampEl = document.getElementById('detailReportTimestampEl');
            const jsDetailReportOfficerEl = document.getElementById('detailReportOfficerEl');
            const jsDetailReportLocationEl = document.getElementById('detailReportLocationEl');
            const jsDetailReportTitleEl = document.getElementById('detailReportTitleEl');
            const jsDetailReportNarrativeEl = document.getElementById('detailReportNarrativeEl');
            const jsDetailReportPersonsEl = document.getElementById('detailReportPersonsEl');
            const jsDetailReportVehiclesEl = document.getElementById('detailReportVehiclesEl');
            const jsDetailReportActionsEl = document.getElementById('detailReportActionsEl');

            const jsCreateReportModalEl = document.getElementById('createReportModalEl');
            const jsCloseCreateReportModalBtnEl = document.getElementById('closeCreateReportModalBtnEl');
            const jsSaveReportBtnEl = document.getElementById('saveReportBtnEl');
            const jsCancelReportBtnEl = document.getElementById('cancelReportBtnEl');
            const jsCreateReportFormEl = document.getElementById('createReportFormEl');
            const jsReportModalIncidentIdInputEl = document.getElementById('reportIncidentIdInputEl');
            const jsReportModalTitleEl = document.getElementById('reportTitleEl');
            const jsReportModalLocationEl = document.getElementById('reportLocationEl');
            const jsReportModalNarrativeEl = document.getElementById('reportNarrativeEl');
            const jsReportModalPersonsInvolvedEl = document.getElementById('reportPersonsInvolvedEl');
            const jsReportModalVehiclesInvolvedEl = document.getElementById('reportVehiclesInvolvedEl');
            const jsReportModalActionsTakenEl = document.getElementById('reportActionsTakenEl');
            const jsUnitStatusListDashboardEl = document.getElementById('unitStatusListDashboardEl');
            const jsDashboardActiveIncidentsListEl = document.getElementById('dashboardActiveIncidentsList');
            const jsDashboardMyReportsListEl = document.getElementById('dashboardMyReportsList');


            const MOCK_DIENSTNUMMER = "PD-61";
            const MOCK_PASSWORT = "lspd_61";
            let pcState = 'off';
            let currentLoggedInUser = "";
            let editingPersonId = null;
            let editingVehiclePlate = null;
            let gCurrentOpenIncidentId = null; // Renamed from currentOpenIncidentId
            let currentActiveUnitId = null;
            let currentMaxZIndex = 900;


            const MENU_BAR_HEIGHT = 28;
            const DOCK_APPROX_HEIGHT = 70;
            const SAFARI_URL = "https://sites.google.com/view/san-andreas-lspd/start?authuser=0";

            const windowStates = {};


            const mockPersonDatabase = [
                {
                    firstName: "John", lastName: "Doe", dob: "1985-05-15", citizenId: "JD12345",
                    address: "123 Vinewood Blvd, Los Santos", phone: "555-0100", occupation: "Unbekannt",
                    profilePicUrl: "https://placehold.co/100x100/3498db/ffffff?text=JD",
                    features: "Narbe über dem linken Auge, Tattoo (Drache) auf dem rechten Unterarm.",
                    vehicles: ["SULTANRS1"], licenses: "Führerschein Klasse B, Waffenschein (abgelaufen)",
                    priors: ["Unerlaubter Waffenbesitz (2020)", "Mehrfacher Diebstahl (2018, 2019)"],
                    notes: "Vorsicht, gilt als gewaltbereit. Oft im Strawberry-Viertel gesehen.",
                    wantedStatus: "Gesucht",
                }
            ];
            const mockVehicleDatabase = [
                {
                    plate: "SULTANRS1", make: "Karin", model: "Sultan RS", color: "Blau",
                    ownerCitizenId: "JD12345", imageUrl: "https://placehold.co/150x100/3498db/ffffff?text=Sultan+RS",
                    wantedStatus: "Kein Eintrag", notes: "Auffällige Spoiler, Sportauspuff."
                }
            ];
            const mockUnitsOnDuty = [];
            const mockIncidentsDatabase = [];
            const mockReportsDatabase = [];

            function setVisibility(element, visible, displayType = 'flex') {
                if (!element) return;
                element.classList.toggle('hidden', !visible);
                if (visible) {
                    if (displayType === 'flex') element.classList.add('flex-display');
                    else element.style.display = displayType;
                } else {
                    element.classList.remove('flex-display');
                    if (element.style.display === displayType) element.style.display = '';
                }
            }

            function generateUniqueId(prefix = "") { return prefix + Date.now().toString(36) + Math.random().toString(36).substring(2); }
            function bringToFront(windowElement) {
                if (!windowElement) return;
                currentMaxZIndex++;
                windowElement.style.zIndex = currentMaxZIndex;
            }

            function showPowerButtonScreen() {
                pcState = 'off';
                setVisibility(jsPowerButtonScreenEl, true);
                setVisibility(jsBootScreenOverlayEl, false); setVisibility(jsMacOSLoginScreenEl, false);
                setVisibility(jsDesktopEnvironmentEl, false); setVisibility(jsShutdownScreenOverlayEl, false);
                if(jsCadWindowEl) jsCadWindowEl.classList.remove('visible');
                if(jsSafariWindowEl) jsSafariWindowEl.classList.remove('visible');
            }

            function startBootProcess() {
                if (pcState !== 'off' && pcState !== 'shutting_down_complete') return;
                pcState = 'booting';
                setVisibility(jsPowerButtonScreenEl, false); setVisibility(jsBootScreenOverlayEl, true);
                let progress = 0;
                if(jsBootProgressBarEl) jsBootProgressBarEl.style.width = '0%';
                const interval = setInterval(() => {
                    progress += Math.random() * 10 + 5;
                    if (progress >= 100) {
                        progress = 100;
                        if(jsBootProgressBarEl) jsBootProgressBarEl.style.width = progress + '%';
                        clearInterval(interval);
                        setTimeout(() => {
                            setVisibility(jsBootScreenOverlayEl, false); setVisibility(jsMacOSLoginScreenEl, true);
                            if(jsMacOSPasswordInputEl) { jsMacOSPasswordInputEl.value = ""; jsMacOSPasswordInputEl.focus(); }
                            if(jsMacOSLoginErrorEl) jsMacOSLoginErrorEl.textContent = "";
                            if(jsMacOSLoginUserNameEl) jsMacOSLoginUserNameEl.textContent = MOCK_DIENSTNUMMER;
                            pcState = 'at_mac_login_screen';
                        }, 500);
                    }
                   if(jsBootProgressBarEl) jsBootProgressBarEl.style.width = progress + '%';
                }, 150);
            }
            if(jsPowerButtonIconEl) jsPowerButtonIconEl.addEventListener('click', startBootProcess);

            function handleMacOSLogin() {
                 if (pcState !== 'at_mac_login_screen' || !jsMacOSPasswordInputEl || !jsMacOSLoginErrorEl) return;
                if (jsMacOSPasswordInputEl.value === MOCK_PASSWORT) {
                    currentLoggedInUser = MOCK_DIENSTNUMMER;
                    setVisibility(jsMacOSLoginScreenEl, false); setVisibility(jsDesktopEnvironmentEl, true);
                    pcState = 'desktop_active'; jsMacOSLoginErrorEl.textContent = "";
                    if(jsOfficerIdDisplayInCADEl) jsOfficerIdDisplayInCADEl.textContent = currentLoggedInUser;
                    if(jsLoggedInOfficerNameEl) jsLoggedInOfficerNameEl.textContent = currentLoggedInUser;
                    if(jsLogoutMacOSMenuItemEl) jsLogoutMacOSMenuItemEl.textContent = `Abmelden (${currentLoggedInUser})...`;
                    initializeAllWindows();
                    switchCadContent('dashboardContent');
                    renderUnitStatusDashboard(); renderActiveIncidents(); renderReportsList(); renderAvailableUnitsForAssignment();
                } else {
                    jsMacOSLoginErrorEl.textContent = 'Passwort ungültig.'; jsMacOSPasswordInputEl.value = ''; jsMacOSPasswordInputEl.focus();
                }
            }
            if (jsMacOSLoginButtonEl) jsMacOSLoginButtonEl.addEventListener('click', handleMacOSLogin);
            if (jsMacOSPasswordInputEl) jsMacOSPasswordInputEl.addEventListener('keypress', (e) => { if (e.key === 'Enter') { e.preventDefault(); handleMacOSLogin(); }});

            function handleMacOSLogout() {
                if (pcState !== 'desktop_active') return;
                if (currentActiveUnitId) {
                     const myUnitIndex = mockUnitsOnDuty.findIndex(u => u.unitId === currentActiveUnitId && u.officer === currentLoggedInUser);
                    if (myUnitIndex > -1) mockUnitsOnDuty.splice(myUnitIndex, 1);
                    currentActiveUnitId = null;
                    if(jsUnitIdInputEl) { jsUnitIdInputEl.value = ""; jsUnitIdInputEl.disabled = false; }
                    if(jsUpdateUnitStatusBtnEl) jsUpdateUnitStatusBtnEl.textContent = "Status aktualisieren / Anmelden";
                    renderActiveUnits(); renderUnitStatusDashboard();
                }
                currentLoggedInUser = ""; setVisibility(jsDesktopEnvironmentEl, false);
                if(jsCadWindowEl) jsCadWindowEl.classList.remove('visible');
                if(jsSafariWindowEl) jsSafariWindowEl.classList.remove('visible');
                setVisibility(jsMacOSLoginScreenEl, true);
                if(jsMacOSPasswordInputEl) { jsMacOSPasswordInputEl.value = ""; jsMacOSPasswordInputEl.focus(); }
                if(jsMacOSLoginErrorEl) jsMacOSLoginErrorEl.textContent = "";
                pcState = 'at_mac_login_screen';
                if(jsAppleMenuDropdownEl) jsAppleMenuDropdownEl.classList.add('hidden');
            }
            if (jsLogoutMacOSMenuItemEl) jsLogoutMacOSMenuItemEl.addEventListener('click', (e) => { e.stopPropagation(); handleMacOSLogout(); });

            function startShutdownProcess() {
                 if (pcState !== 'desktop_active' && pcState !== 'at_mac_login_screen') return;
                if (currentActiveUnitId) {
                    const unitIndex = mockUnitsOnDuty.findIndex(u => u.unitId === currentActiveUnitId && u.officer === currentLoggedInUser);
                    if (unitIndex > -1) mockUnitsOnDuty.splice(unitIndex, 1);
                }
                pcState = 'shutting_down';
                setVisibility(jsDesktopEnvironmentEl, false); setVisibility(jsMacOSLoginScreenEl, false);
                if(jsCadWindowEl) jsCadWindowEl.classList.remove('visible');
                if(jsSafariWindowEl) jsSafariWindowEl.classList.remove('visible');
                setVisibility(jsShutdownScreenOverlayEl, true, 'flex');
                 setTimeout(() => {
                    setVisibility(jsShutdownScreenOverlayEl, false);
                    if(jsBootProgressBarEl) jsBootProgressBarEl.style.width = '0%';
                    pcState = 'shutting_down_complete';
                    showPowerButtonScreen();
                }, 3000);
            }
            if (jsAppleLogoMenuContainerEl && jsAppleMenuDropdownEl) {
                jsAppleLogoMenuContainerEl.addEventListener('click', (e) => { e.stopPropagation(); if (pcState === 'desktop_active') jsAppleMenuDropdownEl.classList.toggle('hidden'); });
                document.addEventListener('click', (e) => { if (jsAppleMenuDropdownEl && !jsAppleMenuDropdownEl.classList.contains('hidden') && !jsAppleLogoMenuContainerEl.contains(e.target)) jsAppleMenuDropdownEl.classList.add('hidden'); });
            }
            if (jsShutdownMenuItemEl) jsShutdownMenuItemEl.addEventListener('click', (e) => { e.stopPropagation(); if(jsAppleMenuDropdownEl) jsAppleMenuDropdownEl.classList.add('hidden'); startShutdownProcess(); });

            function makeWindowInteractive(windowId) {
                const winEl = document.getElementById(windowId);
                const headerEl = document.getElementById(windowId.replace('WindowEl', 'HeaderEl'));
                const closeBtnEl = document.getElementById(windowId.replace('WindowEl', 'CloseBtnEl'));
                const minimizeBtnEl = document.getElementById(windowId.replace('WindowEl', 'MinimizeBtnEl'));
                const maximizeBtnEl = document.getElementById(windowId.replace('WindowEl', 'MaximizeBtnEl'));
                const resizerHandleEl = document.getElementById(windowId.replace('WindowEl', 'ResizerEl'));

                if (!winEl || !headerEl) { console.error("Window or header not found for ID:", windowId); return; }

                windowStates[windowId] = { isMaximized: false, originalSize: {} };
                let offsetX, offsetY, isDragging = false;

                headerEl.addEventListener('mousedown', (e) => {
                    if (pcState !== 'desktop_active' || e.button !== 0 || winEl.classList.contains('maximized')) return;
                    isDragging = true;
                    offsetX = e.clientX - winEl.offsetLeft; offsetY = e.clientY - winEl.offsetTop;
                    winEl.style.transition = 'none'; bringToFront(winEl);
                });

                const docMouseMoveListener = (e) => {
                    if (!isDragging) return;
                    if (pcState !== 'desktop_active' || winEl.classList.contains('maximized')) { isDragging = false; return; }
                    let newX = e.clientX - offsetX; let newY = e.clientY - offsetY;
                    newX = Math.max(0, Math.min(newX, window.innerWidth - winEl.offsetWidth));
                    newY = Math.max(MENU_BAR_HEIGHT, Math.min(newY, window.innerHeight - winEl.offsetHeight));
                    winEl.style.left = newX + 'px'; winEl.style.top = newY + 'px';
                };
                document.addEventListener('mousemove', docMouseMoveListener);

                const docMouseUpListener = () => {
                    if (isDragging) {
                        isDragging = false;
                        winEl.style.transition = '';
                    }
                };
                document.addEventListener('mouseup', docMouseUpListener);


                if (closeBtnEl) {
                    closeBtnEl.addEventListener('click', (e) => {
                        if (pcState !== 'desktop_active') return; e.stopPropagation(); setVisibility(winEl, false);
                    });
                }
                if (minimizeBtnEl) {
                    minimizeBtnEl.addEventListener('click', (e) => {
                        if (pcState !== 'desktop_active') return; e.stopPropagation(); setVisibility(winEl, false);
                    });
                }
                if (maximizeBtnEl) {
                    maximizeBtnEl.addEventListener('click', (e) => {
                        if (pcState !== 'desktop_active') return; e.stopPropagation();
                        const state = windowStates[windowId];
                        if (!state.isMaximized) {
                            state.originalSize = { width: winEl.style.width, height: winEl.style.height, top: winEl.style.top, left: winEl.style.left, borderRadius: winEl.style.borderRadius };
                            Object.assign(winEl.style, { top: `${MENU_BAR_HEIGHT}px`, left: '0px', width: '100vw', height: `calc(100vh - ${MENU_BAR_HEIGHT}px - ${DOCK_APPROX_HEIGHT}px)`});
                            winEl.classList.add('maximized');
                            if(resizerHandleEl) resizerHandleEl.style.display = 'none';
                        } else {
                            Object.assign(winEl.style, {
                                top: state.originalSize.top || (windowId === 'cadWindowEl' ? '60px' : '100px'),
                                left: state.originalSize.left || (windowId === 'cadWindowEl' ? '80px' : '120px'),
                                width: state.originalSize.width || '80vw', height: state.originalSize.height || '75vh',
                                borderRadius: state.originalSize.borderRadius || '12px'
                            });
                            winEl.classList.remove('maximized');
                            if(resizerHandleEl) resizerHandleEl.style.display = 'block';
                        }
                        state.isMaximized = !state.isMaximized; bringToFront(winEl);
                    });
                }

                let isResizing = false;
                if (resizerHandleEl) {
                    resizerHandleEl.addEventListener('mousedown', (e) => {
                        if (pcState !== 'desktop_active' || e.button !== 0 || winEl.classList.contains('maximized')) return;
                        isResizing = true; const startX = e.clientX; const startY = e.clientY;
                        const startWidth = parseInt(window.getComputedStyle(winEl).width, 10);
                        const startHeight = parseInt(window.getComputedStyle(winEl).height, 10);
                        const docResizeMouseMove = (ev) => {
                            if (!isResizing) return;
                            const newWidth = startWidth + ev.clientX - startX;
                            const newHeight = startHeight + ev.clientY - startY;
                            winEl.style.width = Math.max(parseInt(winEl.style.minWidth) || 300, newWidth) + 'px';
                            winEl.style.height = Math.max(parseInt(winEl.style.minHeight) || 200, newHeight) + 'px';
                        };
                        const docResizeMouseUp = () => {
                            isResizing = false; document.removeEventListener('mousemove', docResizeMouseMove); document.removeEventListener('mouseup', docResizeMouseUp);
                        };
                        document.addEventListener('mousemove', docResizeMouseMove);
                        document.addEventListener('mouseup', docResizeMouseUp);
                        e.preventDefault();
                    });
                }
                 winEl.addEventListener('mousedown', () => bringToFront(winEl));
            }

            function initializeAllWindows() {
                makeWindowInteractive('cadWindowEl');
                makeWindowInteractive('safariWindowEl');
            }

            if (jsCadAppIconEl) {
                jsCadAppIconEl.addEventListener('click', () => {
                    if (pcState !== 'desktop_active' || !jsCadWindowEl) return;
                    setVisibility(jsCadWindowEl, !jsCadWindowEl.classList.contains('visible'), 'flex');
                    if (jsCadWindowEl.classList.contains('visible')) bringToFront(jsCadWindowEl);
                });
            }
            if (jsSafariAppIconEl) {
                jsSafariAppIconEl.addEventListener('click', () => {
                    if (pcState !== 'desktop_active' || !jsSafariWindowEl) return;
                    setVisibility(jsSafariWindowEl, !jsSafariWindowEl.classList.contains('visible'), 'flex');
                    if (jsSafariWindowEl.classList.contains('visible')) {
                        bringToFront(jsSafariWindowEl);
                        if (jsSafariFrameEl.src === 'about:blank') jsSafariFrameEl.src = SAFARI_URL;
                    }
                });
            }

            const sidebarItems = document.querySelectorAll('.cad-sidebar-item');
            const contentSections = document.querySelectorAll('.cad-main-content > div[id$="Content"]');
            function switchCadContent(targetId) {
                contentSections.forEach(section => {setVisibility(section, false); section.classList.remove('active-content'); });
                sidebarItems.forEach(item => { item.classList.remove('active'); });
                const targetContent = document.getElementById(targetId);
                const targetSidebarItem = document.querySelector(`.cad-sidebar-item[data-target="${targetId}"]`);
                if (targetContent) { setVisibility(targetContent, true, 'block'); targetContent.classList.add('active-content');}
                if (targetSidebarItem) { targetSidebarItem.classList.add('active'); }
            }
            sidebarItems.forEach(item => item.addEventListener('click', () => { if (pcState === 'desktop_active') switchCadContent(item.getAttribute('data-target')); }));

            function populatePersonModal(person) {
                jsEditingPersonCitizenIdFieldEl.value = person.citizenId;
                jsPersonModalFirstNameEl.value = person.firstName;
                jsPersonModalLastNameEl.value = person.lastName;
                jsPersonModalDobEl.value = person.dob;
                jsPersonModalCitizenIdEl.value = person.citizenId;
                jsPersonModalCitizenIdEl.readOnly = true;
                jsPersonModalAddressEl.value = person.address;
                jsPersonModalPhoneEl.value = person.phone;
                jsPersonModalOccupationEl.value = person.occupation;
                jsPersonModalProfilePicUrlEl.value = person.profilePicUrl;
                jsPersonModalFeaturesEl.value = person.features;
                jsPersonModalLicensesEl.value = person.licenses;
                jsPersonModalWantedStatusEl.value = person.wantedStatus;
                jsPersonModalNotesEl.value = person.notes;
                document.querySelector('#createPersonModalEl .modal-header h4').textContent = "Personenakte bearbeiten";
                setVisibility(jsCreatePersonModalEl, true);
            }

            if (jsEditPersonBtnEl) {
                jsEditPersonBtnEl.addEventListener('click', () => {
                    const citizenId = jsDetailPersonIdEl.textContent;
                    const personToEdit = mockPersonDatabase.find(p => p.citizenId === citizenId);
                    if (personToEdit) populatePersonModal(personToEdit);
                    else alert("Fehler: Person zum Bearbeiten nicht gefunden.");
                });
            }

            function displayPersonDetails(person) {
                 if (!jsPersonDetailViewEl || !person) { setVisibility(jsPersonDetailViewEl, false); return; }
                if(jsDetailPersonProfilePicEl) jsDetailPersonProfilePicEl.src = person.profilePicUrl || 'https://placehold.co/100x100/cccccc/ffffff?text=Bild';
                if(jsDetailViewPersonNameEl) jsDetailViewPersonNameEl.textContent = `${person.firstName} ${person.lastName}`;
                if(jsDetailPersonIdEl) jsDetailPersonIdEl.textContent = person.citizenId || '-';
                if(jsDetailPersonDobEl) jsDetailPersonDobEl.textContent = person.dob || '-';
                if(jsDetailPersonAddressEl) jsDetailPersonAddressEl.textContent = person.address || '-';
                if(jsDetailPersonPhoneEl) jsDetailPersonPhoneEl.textContent = person.phone || '-';
                if(jsDetailPersonOccupationEl) jsDetailPersonOccupationEl.textContent = person.occupation || '-';
                if(jsDetailPersonWantedStatusOutputEl) jsDetailPersonWantedStatusOutputEl.textContent = person.wantedStatus || 'Kein Eintrag';
                if(jsDetailViewPersonWantedFlagEl) {
                    jsDetailViewPersonWantedFlagEl.className = 'flag hidden';
                    if (person.wantedStatus === "Gesucht") { setVisibility(jsDetailViewPersonWantedFlagEl, true, 'inline-block'); jsDetailViewPersonWantedFlagEl.classList.add('wanted'); jsDetailViewPersonWantedFlagEl.textContent = 'GESUCHT'; }
                    else if (person.wantedStatus === "Vorsicht") { setVisibility(jsDetailViewPersonWantedFlagEl, true, 'inline-block'); jsDetailViewPersonWantedFlagEl.classList.add('caution'); jsDetailViewPersonWantedFlagEl.textContent = 'VORSICHT'; }
                }
                if(jsDetailPersonFeaturesEl) jsDetailPersonFeaturesEl.textContent = person.features || '-';
                if(jsDetailPersonVehiclesListEl) {
                    jsDetailPersonVehiclesListEl.innerHTML = '';
                    if (person.vehicles && person.vehicles.length > 0) {
                        person.vehicles.forEach(plate => {
                            const vehicle = mockVehicleDatabase.find(v => v.plate === plate);
                            const li = document.createElement('li');
                            li.textContent = vehicle ? `${plate} (${vehicle.make} ${vehicle.model}, ${vehicle.color})` : plate;
                            jsDetailPersonVehiclesListEl.appendChild(li);
                        });
                    } else jsDetailPersonVehiclesListEl.textContent = '-';
                }
                if(jsDetailPersonLicensesEl) jsDetailPersonLicensesEl.textContent = person.licenses || '-';
                if(jsDetailPersonPriorsEl) {
                    jsDetailPersonPriorsEl.innerHTML = '';
                    if (person.priors && person.priors.length > 0) person.priors.forEach(p => jsDetailPersonPriorsEl.innerHTML += `<li>${p}</li>`);
                    else jsDetailPersonPriorsEl.innerHTML = '<li>Keine Einträge</li>';
                }
                if(jsDetailPersonNotesEl) jsDetailPersonNotesEl.textContent = person.notes || 'Keine Notizen vorhanden.';
                setVisibility(jsPersonDetailViewEl, true, 'block');
            }

            if (jsPersonSearchBtnEl) {
                jsPersonSearchBtnEl.addEventListener('click', () => {
                    if (pcState !== 'desktop_active' || !jsPersonSearchNameInputEl || !jsPersonResultsAreaEl) return;
                    const searchTermName = jsPersonSearchNameInputEl.value.trim().toLowerCase();
                    const searchTermId = jsPersonSearchIdInputEl.value.trim().toLowerCase();
                    setVisibility(jsPersonDetailViewEl, false);
                    const results = mockPersonDatabase.filter(p =>
                        (searchTermName && `${p.firstName.toLowerCase()} ${p.lastName.toLowerCase()}`.includes(searchTermName)) ||
                        (searchTermId && p.citizenId.toLowerCase().includes(searchTermId))
                    );
                    if (results.length > 0) {
                        jsPersonResultsAreaEl.innerHTML = `<p class="text-green-600">${results.length} Treffer gefunden. Erster Treffer wird angezeigt.</p>`;
                        displayPersonDetails(results[0]);
                    } else jsPersonResultsAreaEl.innerHTML = '<p class="text-red-500">Keine Personen für Ihre Suche gefunden.</p>';
                });
            }
            if (jsCreateNewPersonBtnEl) {
                jsCreateNewPersonBtnEl.addEventListener('click', () => {
                    if (pcState === 'desktop_active' && jsCreatePersonModalEl && jsCreatePersonFormEl) {
                        jsCreatePersonFormEl.reset(); jsEditingPersonCitizenIdFieldEl.value = "";
                        jsPersonModalCitizenIdEl.readOnly = false;
                        document.querySelector('#createPersonModalEl .modal-header h4').textContent = "Neue Personenakte erstellen";
                        setVisibility(jsCreatePersonModalEl, true);
                    }
                });
            }
            if (jsCloseCreatePersonModalBtnEl) jsCloseCreatePersonModalBtnEl.addEventListener('click', () => setVisibility(jsCreatePersonModalEl, false));
            if (jsCancelPersonBtnEl) jsCancelPersonBtnEl.addEventListener('click', () => setVisibility(jsCreatePersonModalEl, false));
            if (jsSavePersonBtnEl && jsCreatePersonFormEl) {
                jsSavePersonBtnEl.addEventListener('click', () => {
                    const personData = {
                        firstName: jsPersonModalFirstNameEl.value, lastName: jsPersonModalLastNameEl.value, dob: jsPersonModalDobEl.value,
                        citizenId: jsPersonModalCitizenIdEl.value, address: jsPersonModalAddressEl.value, phone: jsPersonModalPhoneEl.value,
                        occupation: jsPersonModalOccupationEl.value, profilePicUrl: jsPersonModalProfilePicUrlEl.value, features: jsPersonModalFeaturesEl.value,
                        licenses: jsPersonModalLicensesEl.value, wantedStatus: jsPersonModalWantedStatusEl.value, notes: jsPersonModalNotesEl.value,
                        priors: [], vehicles: []
                    };
                    if (!personData.firstName || !personData.lastName || !personData.citizenId) { alert("Vorname, Nachname und Bürger-ID sind Pflichtfelder!"); return; }
                    const existingIdToUpdate = jsEditingPersonCitizenIdFieldEl.value;
                    if (existingIdToUpdate) {
                        const personIndex = mockPersonDatabase.findIndex(p => p.citizenId === existingIdToUpdate);
                        if (personIndex > -1) {
                            personData.priors = mockPersonDatabase[personIndex].priors; personData.vehicles = mockPersonDatabase[personIndex].vehicles;
                            mockPersonDatabase[personIndex] = personData; alert(`Akte für ${personData.firstName} ${personData.lastName} aktualisiert!`);
                            displayPersonDetails(personData);
                        }
                    } else {
                         if (mockPersonDatabase.some(p => p.citizenId === personData.citizenId)) { alert("Eine Person mit dieser Bürger-ID existiert bereits!"); return; }
                        mockPersonDatabase.push(personData); alert(`Akte für ${personData.firstName} ${personData.lastName} erstellt!`);
                        displayPersonDetails(personData);
                    }
                    setVisibility(jsCreatePersonModalEl, false);
                    if(jsPersonResultsAreaEl) jsPersonResultsAreaEl.innerHTML = `<p class="text-green-600">Akte erfolgreich verarbeitet. Details unten.</p>`;
                });
            }

            function populateVehicleModal(vehicle) {
                jsEditingVehiclePlateFieldEl.value = vehicle.plate;
                jsVehicleModalPlateEl.value = vehicle.plate; jsVehicleModalPlateEl.readOnly = true;
                jsVehicleModalMakeEl.value = vehicle.make; jsVehicleModalModelEl.value = vehicle.model;
                jsVehicleModalColorEl.value = vehicle.color; jsVehicleModalOwnerCitizenIdEl.value = vehicle.ownerCitizenId;
                jsVehicleModalImageUrlEl.value = vehicle.imageUrl; jsVehicleModalWantedStatusEl.value = vehicle.wantedStatus;
                jsVehicleModalNotesEl.value = vehicle.notes;
                document.querySelector('#createVehicleModalEl .modal-header h4').textContent = "Fahrzeugakte bearbeiten";
                setVisibility(jsCreateVehicleModalEl, true);
            }

            if (jsEditVehicleBtnEl) {
                jsEditVehicleBtnEl.addEventListener('click', () => {
                    const plate = jsDetailVehiclePlateEl.textContent;
                    const vehicleToEdit = mockVehicleDatabase.find(v => v.plate === plate);
                    if (vehicleToEdit) populateVehicleModal(vehicleToEdit);
                    else alert("Fehler: Fahrzeug zum Bearbeiten nicht gefunden.");
                });
            }

            function displayVehicleDetails(vehicle) {
                if (!jsVehicleDetailViewEl || !vehicle) { setVisibility(jsVehicleDetailViewEl, false); return; }
                if(jsDetailVehicleImageEl) jsDetailVehicleImageEl.src = vehicle.imageUrl || 'https://placehold.co/150x100/cccccc/ffffff?text=Fahrzeug';
                if(jsDetailVehiclePlateEl) jsDetailVehiclePlateEl.textContent = vehicle.plate;
                if(jsDetailVehicleMakeEl) jsDetailVehicleMakeEl.textContent = vehicle.make || '-';
                if(jsDetailVehicleModelEl) jsDetailVehicleModelEl.textContent = vehicle.model || '-';
                if(jsDetailVehicleColorEl) jsDetailVehicleColorEl.textContent = vehicle.color || '-';
                if(jsDetailVehicleOwnerNameEl && jsDetailVehicleOwnerIdEl) {
                    const owner = mockPersonDatabase.find(p => p.citizenId === vehicle.ownerCitizenId);
                    jsDetailVehicleOwnerNameEl.textContent = owner ? `${owner.firstName} ${owner.lastName}` : (vehicle.ownerCitizenId ? 'Unbekannt' : '-');
                    jsDetailVehicleOwnerIdEl.textContent = vehicle.ownerCitizenId || '-';
                }
                if(jsDetailVehicleWantedStatusOutputEl) jsDetailVehicleWantedStatusOutputEl.textContent = vehicle.wantedStatus || 'Kein Eintrag';
                if(jsDetailVehicleWantedFlagEl) {
                    jsDetailVehicleWantedFlagEl.className = 'flag hidden';
                    if (vehicle.wantedStatus === "Gestohlen" || vehicle.wantedStatus === "Zur Fahndung (Verbrechen)") {
                        setVisibility(jsDetailVehicleWantedFlagEl, true, 'inline-block'); jsDetailVehicleWantedFlagEl.classList.add('wanted');
                        jsDetailVehicleWantedFlagEl.textContent = vehicle.wantedStatus.toUpperCase();
                    }
                }
                if(jsDetailVehicleNotesEl) jsDetailVehicleNotesEl.textContent = vehicle.notes || 'Keine Notizen vorhanden.';
                setVisibility(jsVehicleDetailViewEl, true, 'block');
            }

            if(jsVehicleSearchBtnEl) {
                jsVehicleSearchBtnEl.addEventListener('click', () => {
                    if (pcState !== 'desktop_active' || !jsVehicleSearchPlateInputEl || !jsVehicleResultsAreaEl) return;
                    const searchTermPlate = jsVehicleSearchPlateInputEl.value.trim().toUpperCase();
                    const searchTermOwnerId = jsVehicleSearchOwnerIdInputEl.value.trim();
                    setVisibility(jsVehicleDetailViewEl, false);
                    const results = mockVehicleDatabase.filter(v =>
                        (searchTermPlate && v.plate.toUpperCase().includes(searchTermPlate)) ||
                        (searchTermOwnerId && v.ownerCitizenId === searchTermOwnerId)
                    );
                    if (results.length > 0) {
                        jsVehicleResultsAreaEl.innerHTML = `<p class="text-green-600">${results.length} Fahrzeug(e) gefunden. Erster Treffer wird angezeigt.</p>`;
                        displayVehicleDetails(results[0]);
                    } else jsVehicleResultsAreaEl.innerHTML = '<p class="text-red-500">Keine Fahrzeuge für Ihre Suche gefunden.</p>';
                });
            }
            if(jsCreateNewVehicleBtnEl) {
                 jsCreateNewVehicleBtnEl.addEventListener('click', () => {
                    if (pcState === 'desktop_active' && jsCreateVehicleModalEl && jsCreateVehicleFormEl) {
                        jsCreateVehicleFormEl.reset(); jsEditingVehiclePlateFieldEl.value = "";
                        jsVehicleModalPlateEl.readOnly = false;
                        document.querySelector('#createVehicleModalEl .modal-header h4').textContent = "Neues Fahrzeug erfassen";
                        setVisibility(jsCreateVehicleModalEl, true);
                    }
                });
            }
            if(jsCloseCreateVehicleModalBtnEl) jsCloseCreateVehicleModalBtnEl.addEventListener('click', () => setVisibility(jsCreateVehicleModalEl, false));
            if(jsCancelVehicleBtnEl) jsCancelVehicleBtnEl.addEventListener('click', () => setVisibility(jsCreateVehicleModalEl, false));
            if(jsSaveVehicleBtnEl && jsCreateVehicleFormEl) {
                jsSaveVehicleBtnEl.addEventListener('click', () => {
                    const vehicleData = {
                        plate: jsVehicleModalPlateEl.value.toUpperCase(), make: jsVehicleModalMakeEl.value, model: jsVehicleModalModelEl.value,
                        color: jsVehicleModalColorEl.value, ownerCitizenId: jsVehicleModalOwnerCitizenIdEl.value, imageUrl: jsVehicleModalImageUrlEl.value,
                        wantedStatus: jsVehicleModalWantedStatusEl.value, notes: jsVehicleModalNotesEl.value
                    };
                    if (!vehicleData.plate) { alert("Kennzeichen ist ein Pflichtfeld!"); return; }
                    const existingPlateToUpdate = jsEditingVehiclePlateFieldEl.value;
                    if (existingPlateToUpdate) {
                        const vehicleIndex = mockVehicleDatabase.findIndex(v => v.plate === existingPlateToUpdate);
                        if (vehicleIndex > -1) {
                            const oldOwnerId = mockVehicleDatabase[vehicleIndex].ownerCitizenId;
                            if (oldOwnerId && oldOwnerId !== vehicleData.ownerCitizenId) {
                                const oldOwner = mockPersonDatabase.find(p => p.citizenId === oldOwnerId);
                                if (oldOwner && oldOwner.vehicles) oldOwner.vehicles = oldOwner.vehicles.filter(vPlate => vPlate !== existingPlateToUpdate);
                            }
                            mockVehicleDatabase[vehicleIndex] = vehicleData; alert(`Fahrzeug ${vehicleData.plate} aktualisiert!`);
                        }
                    } else {
                        if (mockVehicleDatabase.some(v => v.plate === vehicleData.plate)) { alert("Ein Fahrzeug mit diesem Kennzeichen existiert bereits!"); return; }
                        mockVehicleDatabase.push(vehicleData); alert(`Fahrzeug ${vehicleData.plate} erstellt!`);
                    }
                    if (vehicleData.ownerCitizenId) {
                        const owner = mockPersonDatabase.find(p => p.citizenId === vehicleData.ownerCitizenId);
                        if (owner) {
                            if (!owner.vehicles) owner.vehicles = [];
                            if (!owner.vehicles.includes(vehicleData.plate)) owner.vehicles.push(vehicleData.plate);
                        } else alert("Warnung: Angegebene Halter Bürger-ID nicht gefunden.");
                    }
                    setVisibility(jsCreateVehicleModalEl, false); displayVehicleDetails(vehicleData);
                    if(jsVehicleResultsAreaEl) jsVehicleResultsAreaEl.innerHTML = `<p class="text-green-600">Fahrzeug ${vehicleData.plate} verarbeitet.</p>`;
                });
            }

            function renderActiveUnits() {
                if (!jsActiveUnitsListEl || !jsAssignUnitToIncidentSelectEl) return;
                jsActiveUnitsListEl.innerHTML = ''; jsAssignUnitToIncidentSelectEl.innerHTML = '<option value="">Einheit auswählen...</option>';
                if (mockUnitsOnDuty.length === 0) { jsActiveUnitsListEl.innerHTML = '<p class="text-sm text-gray-500">Keine Einheiten im Dienst.</p>'; return; }
                const ul = document.createElement('ul'); ul.className = 'space-y-2';
                mockUnitsOnDuty.forEach(unit => {
                    const li = document.createElement('li'); li.className = 'text-sm p-2 border rounded-md flex justify-between items-center';
                    let statusClass = 'status-offduty';
                    if (unit.status === 'Verfügbar') statusClass = 'status-available';
                    else if (unit.status === 'Im Einsatz') statusClass = 'status-busy';
                    else if (unit.status === 'Pause') statusClass = 'status-unavailable';
                    li.innerHTML = `<div><span class="status-dot ${statusClass}"></span> <strong>${unit.unitId}</strong> (${unit.officer})</div> <span>${unit.status}</span>`;
                    ul.appendChild(li);
                    if (unit.status === 'Verfügbar') {
                        const option = document.createElement('option'); option.value = unit.unitId;
                        option.textContent = `${unit.unitId} (${unit.officer})`; jsAssignUnitToIncidentSelectEl.appendChild(option);
                    }
                });
                jsActiveUnitsListEl.appendChild(ul);
            }

            function renderActiveIncidents() {
                if (!jsActiveIncidentsTableBodyEl) return;
                jsActiveIncidentsTableBodyEl.innerHTML = '';
                if (mockIncidentsDatabase.length === 0) { jsActiveIncidentsTableBodyEl.innerHTML = '<tr><td colspan="7" class="text-center text-gray-500">Keine aktiven Einsätze.</td></tr>'; return; }
                mockIncidentsDatabase.forEach(incident => {
                    const row = jsActiveIncidentsTableBodyEl.insertRow();
                    row.insertCell().textContent = incident.incidentId; row.insertCell().textContent = incident.type;
                    row.insertCell().textContent = incident.priority; row.insertCell().textContent = incident.location;
                    row.insertCell().textContent = incident.status; row.insertCell().textContent = incident.assignedUnits.join(', ') || '-';
                    const actionsCell = row.insertCell(); actionsCell.className = 'action-buttons';
                    const detailsBtn = document.createElement('button'); detailsBtn.innerHTML = '<i class="fas fa-eye"></i> Details';
                    detailsBtn.onclick = () => displayIncidentDetails(incident.incidentId); actionsCell.appendChild(detailsBtn);
                });
                 renderDashboardLists();
            }

            function displayIncidentDetails(incidentId) {
                const incident = mockIncidentsDatabase.find(inc => inc.incidentId === incidentId);
                if (!incident || !jsIncidentDetailViewEl) { setVisibility(jsIncidentDetailViewEl, false); gCurrentOpenIncidentId = null; return; }
                gCurrentOpenIncidentId = incident.incidentId; // Use renamed global variable
                jsDetailIncidentIdEl.textContent = incident.incidentId; jsDetailIncidentTypeEl.textContent = incident.type;
                jsDetailIncidentLocationEl.textContent = incident.location; jsDetailIncidentPriorityEl.textContent = incident.priority;
                jsDetailIncidentStatusEl.textContent = incident.status; jsDetailIncidentDescriptionEl.textContent = incident.description;
                jsDetailIncidentUnitsEl.textContent = incident.assignedUnits.join(', ') || 'Keine';
                setVisibility(jsIncidentDetailViewEl, true, 'block'); renderAvailableUnitsForAssignment();
            }
             function renderAvailableUnitsForAssignment() {
                if (!jsAssignUnitToIncidentSelectEl) return;
                jsAssignUnitToIncidentSelectEl.innerHTML = '<option value="">Einheit auswählen...</option>';
                mockUnitsOnDuty.filter(u => u.status === 'Verfügbar').forEach(unit => {
                    const option = document.createElement('option'); option.value = unit.unitId;
                    option.textContent = `${unit.unitId} (${unit.officer})`; jsAssignUnitToIncidentSelectEl.appendChild(option);
                });
            }

            if (jsUpdateUnitStatusBtnEl) {
                jsUpdateUnitStatusBtnEl.addEventListener('click', () => {
                    const unitId = jsUnitIdInputEl.value.trim();
                    const status = jsUnitStatusSelectEl.value;

                    if (!unitId && status !== "Nicht im Dienst" && !currentActiveUnitId) {
                        alert("Bitte Einheit-ID eingeben, um sich anzumelden.");
                        return;
                    }

                    if (currentActiveUnitId && ( (unitId && unitId !== currentActiveUnitId) || status === "Nicht im Dienst") ) {
                        const myUnitIndex = mockUnitsOnDuty.findIndex(u => u.unitId === currentActiveUnitId && u.officer === currentLoggedInUser);
                        if (myUnitIndex > -1) {
                            mockUnitsOnDuty.splice(myUnitIndex, 1);
                        }
                        currentActiveUnitId = null;
                        jsUnitIdInputEl.value = "";
                        jsUnitIdInputEl.disabled = false;
                        jsUpdateUnitStatusBtnEl.textContent = "Status aktualisieren / Anmelden";
                    }

                    if (status === "Nicht im Dienst") {
                        if (!currentActiveUnitId && unitId) {
                             const otherUnitIndex = mockUnitsOnDuty.findIndex(u => u.unitId === unitId);
                             if(otherUnitIndex > -1 && mockUnitsOnDuty[otherUnitIndex].officer !== currentLoggedInUser){
                                 alert("Diese Einheit ist von einem anderen Officer registriert.");
                             } else if (otherUnitIndex > -1) {
                                 mockUnitsOnDuty.splice(otherUnitIndex, 1);
                             }
                        }
                        jsUnitIdInputEl.value = "";
                        jsUnitIdInputEl.disabled = false;
                        jsUpdateUnitStatusBtnEl.textContent = "Status aktualisieren / Anmelden";
                        renderActiveUnits();
                        renderUnitStatusDashboard();
                        return;
                    }

                    const targetUnitId = currentActiveUnitId || unitId;
                    if (!targetUnitId) {
                        alert("Fehler: Keine Einheit-ID zum Aktualisieren.");
                        return;
                    }

                    if (!currentActiveUnitId && mockUnitsOnDuty.some(u => u.unitId === targetUnitId && u.officer !== currentLoggedInUser)) {
                        alert(`Einheit-ID ${targetUnitId} ist bereits von einem anderen Officer belegt.`);
                        return;
                    }

                    const existingUnitIndex = mockUnitsOnDuty.findIndex(u => u.unitId === targetUnitId);
                    if (existingUnitIndex > -1) {
                        if (mockUnitsOnDuty[existingUnitIndex].officer === currentLoggedInUser) {
                             mockUnitsOnDuty[existingUnitIndex].status = status;
                        } else {
                            alert(`Einheit-ID ${targetUnitId} ist bereits von einem anderen Officer belegt.`);
                            return;
                        }
                    } else {
                        mockUnitsOnDuty.push({ unitId: targetUnitId, officer: currentLoggedInUser, status });
                    }

                    currentActiveUnitId = targetUnitId;
                    jsUnitIdInputEl.value = currentActiveUnitId;
                    jsUnitIdInputEl.disabled = true;
                    jsUpdateUnitStatusBtnEl.textContent = "Status aktualisieren";


                    renderActiveUnits();
                    renderUnitStatusDashboard();
                });
            }


            if (jsCreateNewIncidentBtnEl) { jsCreateNewIncidentBtnEl.addEventListener('click', () => { jsCreateIncidentFormEl.reset(); document.querySelector('#createIncidentModalEl .modal-header h4').textContent = "Neuen Einsatz erstellen"; setVisibility(jsCreateIncidentModalEl, true); }); }
            if(jsCloseCreateIncidentModalBtnEl) jsCloseCreateIncidentModalBtnEl.addEventListener('click', () => setVisibility(jsCreateIncidentModalEl, false));
            if(jsCancelIncidentBtnEl) jsCancelIncidentBtnEl.addEventListener('click', () => setVisibility(jsCreateIncidentModalEl, false));
            if (jsSaveIncidentBtnEl) {
                jsSaveIncidentBtnEl.addEventListener('click', () => {
                    const incidentData = {
                        incidentId: generateUniqueId("E"), type: jsIncidentModalTypeEl.value, priority: jsIncidentModalPriorityEl.value,
                        location: jsIncidentModalLocationEl.value, callerName: jsIncidentModalCallerNameEl.value, callerPhone: jsIncidentModalCallerPhoneEl.value,
                        description: jsIncidentModalDescriptionEl.value, status: "Offen", assignedUnits: [], timestamp: new Date().toLocaleString('de-DE')
                    };
                    if (!incidentData.location || !incidentData.description) { alert("Ort und Beschreibung sind Pflichtfelder!"); return; }
                    mockIncidentsDatabase.push(incidentData); alert(`Einsatz #${incidentData.incidentId} erstellt!`);
                    setVisibility(jsCreateIncidentModalEl, false); renderActiveIncidents();
                });
            }

            if (jsAssignUnitBtnEl && jsAssignUnitToIncidentSelectEl) {
                jsAssignUnitBtnEl.addEventListener('click', () => {
                    if (!gCurrentOpenIncidentId) { alert("Kein Einsatz ausgewählt."); return; } // Use renamed global variable
                    const unitIdToAssign = jsAssignUnitToIncidentSelectEl.value;
                    if (!unitIdToAssign) { alert("Bitte eine Einheit auswählen."); return; }
                    const incident = mockIncidentsDatabase.find(inc => inc.incidentId === gCurrentOpenIncidentId); // Use renamed global variable
                    const unit = mockUnitsOnDuty.find(u => u.unitId === unitIdToAssign);
                    if (incident && unit && unit.status === 'Verfügbar') {
                        if (!incident.assignedUnits.includes(unitIdToAssign)) {
                            incident.assignedUnits.push(unitIdToAssign); incident.status = "Zugewiesen"; unit.status = "Im Einsatz";
                            alert(`${unitIdToAssign} wurde Einsatz #${incident.incidentId} zugewiesen.`);
                            displayIncidentDetails(incident.incidentId); renderActiveIncidents(); renderActiveUnits(); renderUnitStatusDashboard(); renderAvailableUnitsForAssignment();
                        } else alert(`${unitIdToAssign} ist diesem Einsatz bereits zugewiesen.`);
                    } else alert("Fehler bei der Zuweisung. Einsatz oder Einheit nicht gefunden/verfügbar.");
                });
            }

            if (jsCreateReportFromIncidentBtnEl) {
                jsCreateReportFromIncidentBtnEl.addEventListener('click', () => {
                    if (!gCurrentOpenIncidentId) { alert("Kein Einsatz für Berichterstellung ausgewählt."); return; } // Use renamed global variable
                    const incident = mockIncidentsDatabase.find(inc => inc.incidentId === gCurrentOpenIncidentId); // Use renamed global variable
                    if (incident && jsCreateReportModalEl && jsCreateReportFormEl) {
                        jsCreateReportFormEl.reset(); jsReportModalIncidentIdInputEl.value = incident.incidentId;
                        jsReportModalLocationEl.value = incident.location; jsReportModalTitleEl.value = `Bericht zu Einsatz #${incident.incidentId} - ${incident.type}`;
                        document.querySelector('#createReportModalEl .modal-header h4').textContent = "Bericht erstellen";
                        setVisibility(jsCreateReportModalEl, true); switchCadContent('reportsContent');
                    }
                });
            }

            function renderReportsList() {
                if (!jsReportsListAreaTableBodyEl) return;
                jsReportsListAreaTableBodyEl.innerHTML = '';
                if (mockReportsDatabase.length === 0) { jsReportsListAreaTableBodyEl.innerHTML = '<tr><td colspan="6" class="text-center text-gray-500">Keine Berichte vorhanden.</td></tr>'; return; }
                mockReportsDatabase.forEach(report => {
                    const row = jsReportsListAreaTableBodyEl.insertRow();
                    row.insertCell().textContent = report.reportId; row.insertCell().textContent = report.incidentId || '-';
                    row.insertCell().textContent = report.title; row.insertCell().textContent = report.timestamp;
                    row.insertCell().textContent = report.officer;
                    const actionsCell = row.insertCell(); actionsCell.className = 'action-buttons';
                    const viewBtn = document.createElement('button'); viewBtn.innerHTML = '<i class="fas fa-eye"></i> Ansehen';
                    viewBtn.onclick = () => displayReportDetails(report.reportId); actionsCell.appendChild(viewBtn);
                });
                renderDashboardLists();
            }

            function displayReportDetails(reportId) {
                const report = mockReportsDatabase.find(r => r.reportId === reportId);
                if (!report || !jsReportDetailViewEl) { setVisibility(jsReportDetailViewEl, false); return; }
                jsDetailReportIdEl.textContent = report.reportId; jsDetailReportIncidentIdEl.textContent = report.incidentId || 'N/A';
                jsDetailReportTimestampEl.textContent = report.timestamp; jsDetailReportOfficerEl.textContent = report.officer;
                jsDetailReportLocationEl.textContent = report.location; jsDetailReportTitleEl.textContent = report.title;
                jsDetailReportNarrativeEl.textContent = report.narrative; jsDetailReportActionsEl.textContent = report.actionsTaken || '-';
                jsDetailReportPersonsEl.innerHTML = report.personsInvolved && report.personsInvolved.length > 0 ? report.personsInvolved.map(p => `<li>${p}</li>`).join('') : '<li>Keine</li>';
                jsDetailReportVehiclesEl.innerHTML = report.vehiclesInvolved && report.vehiclesInvolved.length > 0 ? report.vehiclesInvolved.map(v => `<li>${v}</li>`).join('') : '<li>Keine</li>';
                setVisibility(jsReportDetailViewEl, true, 'block');
            }

            if(jsCloseCreateReportModalBtnEl) jsCloseCreateReportModalBtnEl.addEventListener('click', () => setVisibility(jsCreateReportModalEl, false));
            if(jsCancelReportBtnEl) jsCancelReportBtnEl.addEventListener('click', () => setVisibility(jsCreateReportModalEl, false));
            if(jsSaveReportBtnEl) {
                jsSaveReportBtnEl.addEventListener('click', () => {
                    const reportData = {
                        reportId: generateUniqueId("R"), incidentId: jsReportModalIncidentIdInputEl.value, title: jsReportModalTitleEl.value,
                        location: jsReportModalLocationEl.value, narrative: jsReportModalNarrativeEl.value,
                        personsInvolved: jsReportModalPersonsInvolvedEl.value.split('\n').filter(p => p.trim() !== ""),
                        vehiclesInvolved: jsReportModalVehiclesInvolvedEl.value.split('\n').filter(v => v.trim() !== ""),
                        actionsTaken: jsReportModalActionsTakenEl.value, officer: currentLoggedInUser, timestamp: new Date().toLocaleString('de-DE')
                    };
                    if (!reportData.title || !reportData.narrative) { alert("Titel und Sachverhalt sind Pflichtfelder!"); return; }
                    mockReportsDatabase.push(reportData); alert(`Bericht #${reportData.reportId} gespeichert!`);
                    setVisibility(jsCreateReportModalEl, false); renderReportsList();
                });
            }
            function renderDashboardLists() {
                if (jsDashboardActiveIncidentsListEl) {
                    jsDashboardActiveIncidentsListEl.innerHTML = '';
                    const activeIncidents = mockIncidentsDatabase.filter(inc => inc.status !== "Abgeschlossen").slice(0, 3);
                    if (activeIncidents.length === 0) jsDashboardActiveIncidentsListEl.innerHTML = '<li>Keine aktiven Einsätze</li>';
                    else activeIncidents.forEach(inc => { const li = document.createElement('li'); li.textContent = `#${inc.incidentId}: ${inc.type} - ${inc.location}`; jsDashboardActiveIncidentsListEl.appendChild(li); });
                }
                if (jsDashboardMyReportsListEl) {
                    jsDashboardMyReportsListEl.innerHTML = '';
                    const myReports = mockReportsDatabase.filter(rep => rep.officer === currentLoggedInUser).sort((a,b) => new Date(b.timestamp) - new Date(a.timestamp)).slice(0,2);
                    if (myReports.length === 0) jsDashboardMyReportsListEl.innerHTML = '<li>Keine Berichte von Ihnen</li>';
                    else myReports.forEach(rep => { const li = document.createElement('li'); li.textContent = `#${rep.reportId}: ${rep.title}`; jsDashboardMyReportsListEl.appendChild(li); });
                }
            }

            function renderUnitStatusDashboard() {
                if (!jsUnitStatusListDashboardEl) return;
                jsUnitStatusListDashboardEl.innerHTML = '';
                if (mockUnitsOnDuty.length === 0) { jsUnitStatusListDashboardEl.innerHTML = '<li>Keine Einheiten im Dienst</li>'; return; }
                mockUnitsOnDuty.forEach(unit => {
                    const li = document.createElement('li'); let statusClass = 'status-offduty';
                    if (unit.status === 'Verfügbar') statusClass = 'status-available';
                    else if (unit.status === 'Im Einsatz') statusClass = 'status-busy';
                    else if (unit.status === 'Pause') statusClass = 'status-unavailable';
                    li.innerHTML = `<span class="status-dot ${statusClass}"></span> ${unit.unitId} (${unit.officer}) - ${unit.status}`;
                    jsUnitStatusListDashboardEl.appendChild(li);
                });
            }

            let isResizing = false; // This variable is declared multiple times if makeWindowInteractive is not careful
            // For resizing, ensure the isResizing, and document event listeners are managed per window instance or carefully scoped.
            // The current makeWindowInteractive creates new listeners each time it's called for resizing.
            // This might lead to multiple listeners if not handled correctly.
            // A better approach would be to attach one set of listeners and manage which window is being resized.
            // However, for this fix, I'll focus on the reported SyntaxError.

            function updateTime() {
                if (jsCurrentTimeEl) {
                    const now = new Date(), options = { weekday: 'short', hour: '2-digit', minute: '2-digit' };
                    try { jsCurrentTimeEl.textContent = now.toLocaleTimeString('de-DE', options).replace(' Uhr', ''); }
                    catch (e) { jsCurrentTimeEl.textContent = now.toLocaleTimeString(undefined, options).replace(' Uhr', '');}
                }
            }
            updateTime(); setInterval(updateTime, 30000);

            showPowerButtonScreen();
        });
    </script>
</body>
</html>
